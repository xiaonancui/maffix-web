[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
-[ ] NAME:Maffix Web MVP Development - Complete Implementation Plan DESCRIPTION:Comprehensive development plan for the Maffix Web platform MVP, focusing on TikTok-exclusive musician fan engagement with gamification, missions, and monetization systems.
--[x] NAME:Task 1: Project Documentation Organization DESCRIPTION:Review, organize, and consolidate all documentation files into the /docs folder with a logical structure
---[x] NAME:1.1: Audit existing documentation files DESCRIPTION:Review all .md files in root directory (ARCHITECTURE.md, QUICK_FIX_VERCEL_LOGIN.md, QUICK_START.md, README.md, README.old.md, REFACTORING_COMPLETE.md, SUPABASE_FIX_GUIDE.md, TESTING_GUIDE.md, TEST_ACCOUNTS_GUIDE.md, TEST_SUMMARY.md, VERCEL_*.md files)
---[x] NAME:1.2: Create documentation categorization structure DESCRIPTION:Design folder structure within /docs: /docs/architecture, /docs/deployment, /docs/development, /docs/testing, /docs/refactoring-history
---[x] NAME:1.3: Move and organize documentation files DESCRIPTION:Move files to appropriate folders: Architecture docs → /docs/architecture, Deployment/Vercel docs → /docs/deployment, Testing docs → /docs/testing, Refactoring docs → /docs/refactoring-history
---[x] NAME:1.4: Update main README.md DESCRIPTION:Update root README.md with links to organized documentation and remove outdated content
---[x] NAME:1.5: Create documentation index DESCRIPTION:Create /docs/README.md as master index with descriptions and links to all documentation
--[x] NAME:Task 2: Frontend Page Creation & Enhancement DESCRIPTION:Audit current frontend implementation and create comprehensive user-facing pages beyond basic login interface
---[x] NAME:2.1: Audit existing frontend pages DESCRIPTION:Review current pages: (auth)/login, (auth)/register, (dashboard)/dashboard, (dashboard)/tasks, (dashboard)/gacha, (dashboard)/prizes, (dashboard)/profile, (admin)/admin. Identify gaps and missing functionality
---[x] NAME:2.2: Create Mission/Tasks listing page DESCRIPTION:Create comprehensive mission listing page showing available TikTok missions (Follow, Like, Repost, Use Audio) with clear descriptions, reward amounts, completion status, and action buttons
---[x] NAME:2.3: Create Mission detail/verification page DESCRIPTION:Create page for users to view mission details, submit proof of completion, and track verification status
---[x] NAME:2.4: Create Premium Pack store page DESCRIPTION:Create store page displaying available Premium Packs with guaranteed merchandise items and bonus draw tickets, with Klarna payment integration
---[x] NAME:2.5: Enhance Gacha page with 10x draw DESCRIPTION:Update existing Gacha page to support both single draw and 10x draw options with appropriate animations and result displays
---[x] NAME:2.6: Create transaction history page DESCRIPTION:Create page showing user's Diamond transaction history (earned from missions, spent on gacha, purchased)
---[x] NAME:2.7: Create TikTok account linking page DESCRIPTION:Create dedicated page for users to link/unlink their TikTok account with clear instructions and status display
---[x] NAME:2.8: Enhance navigation and user flow DESCRIPTION:Update navigation menu, add breadcrumbs, improve mobile responsiveness, and ensure consistent UI/UX across all pages
--[/] NAME:Task 3: User System Implementation DESCRIPTION:Implement complete user authentication system with email/password, JWT sessions, and TikTok OAuth integration
---[x] NAME:3.1 Backend: Enhance user registration API DESCRIPTION:Review and enhance existing /api/auth/register endpoint to ensure proper validation, password hashing with bcrypt, and error handling
---[x] NAME:3.2 Backend: Enhance login API with JWT DESCRIPTION:Review and enhance existing NextAuth.js credentials provider to ensure secure JWT token generation and session management
---[x] NAME:3.3 Backend: Implement TikTok OAuth provider DESCRIPTION:Create custom TikTok OAuth provider for NextAuth.js using OAuth 2.0 protocol (authorization endpoint, token exchange, userinfo endpoint). Reference: .backup/auth.ts for TikTok provider structure
---[/] NAME:3.4 Backend: Create TikTok account linking API DESCRIPTION:Create API endpoints: POST /api/user/link-tiktok (initiate linking), POST /api/user/unlink-tiktok (remove link), GET /api/user/tiktok-status (check link status)
---[x] NAME:3.5 Backend: Update User model for TikTok data DESCRIPTION:Extend User model in Prisma schema to store TikTok-specific data: tiktokUsername, tiktokUserId, tiktokAccessToken (encrypted), tiktokRefreshToken, tiktokTokenExpiry
---[ ] NAME:3.6 Frontend: Enhance Login page DESCRIPTION:Update login page to include TikTok login button alongside email/password form with proper error handling and loading states
---[ ] NAME:3.7 Frontend: Enhance Registration page DESCRIPTION:Update registration page with improved validation, password strength indicator, and option to link TikTok account during registration
---[ ] NAME:3.8 Frontend: Create TikTok linking flow UI DESCRIPTION:Create UI components for TikTok account linking: OAuth redirect flow, success/error callbacks, account status display in profile
---[ ] NAME:3.9 Testing: Test authentication flows DESCRIPTION:Test email/password registration and login, JWT token generation and validation, TikTok OAuth flow, account linking/unlinking, session persistence
--[ ] NAME:Task 4: Gacha System Implementation DESCRIPTION:Implement complete Gacha system with single/10x draws, probability distribution, and SSR guarantee mechanism
---[ ] NAME:4.1 Backend: Update Prisma schema for Gacha enhancements DESCRIPTION:Add fields to support 10x draws, SSR guarantee tracking, and draw ticket system. Add DrawTicket model, update GachaPull to track multi-pulls, add pityCounter to User model
---[ ] NAME:4.2 Backend: Implement single draw API endpoint DESCRIPTION:Review and enhance existing /api/gacha/pull endpoint: validate Diamond balance, implement weighted probability selection, deduct Diamonds, create GachaPull record, award prize to user
---[ ] NAME:4.3 Backend: Implement 10x draw API endpoint DESCRIPTION:Create /api/gacha/pull-10x endpoint: validate Diamond balance (10x cost), perform 10 draws with probability distribution, ENFORCE SSR guarantee (at least 1 SSR or higher in every 10x draw), return all 10 results
---[ ] NAME:4.4 Backend: Implement SSR guarantee mechanism DESCRIPTION:Create guarantee logic: track pity counter per user, if 10x draw doesn't naturally contain SSR+, force replace lowest rarity item with guaranteed SSR, reset pity counter appropriately
---[ ] NAME:4.5 Backend: Implement prize pool management DESCRIPTION:Create weighted probability distribution system: define rarity tiers (Common 60%, Rare 25%, Epic 10%, SSR 4%, Legendary 1%), implement random selection algorithm, handle stock management for limited prizes
---[ ] NAME:4.6 Backend: Create draw ticket system DESCRIPTION:Implement draw ticket logic: create DrawTicket model, API to use tickets instead of Diamonds, track ticket expiry, integrate with Premium Pack purchases
---[ ] NAME:4.7 Frontend: Update Gacha page UI DESCRIPTION:Enhance existing /gacha page: add 10x draw button, display draw ticket balance, show pity counter/guarantee status, improve visual feedback for draws
---[ ] NAME:4.8 Frontend: Create draw result animation DESCRIPTION:Implement engaging result display: single draw animation with rarity reveal, 10x draw results grid with highlight for SSR+ items, celebration effects for rare pulls
---[ ] NAME:4.9 Testing: Test Gacha system thoroughly DESCRIPTION:Test single draw probability distribution, test 10x draw SSR guarantee (run 100+ test draws), verify Diamond/ticket deduction, test edge cases (insufficient balance, out of stock prizes), verify transaction logging
--[ ] NAME:Task 5: Monetization System Implementation DESCRIPTION:Integrate Klarna payment processing with Premium Pack store and webhook handling
---[ ] NAME:5.1 Backend: Update Prisma schema for monetization DESCRIPTION:Add models: PremiumPack (id, name, description, price, guaranteedPrizeId, bonusTickets, isActive), Purchase (id, userId, packId, klarnaOrderId, status, amount, completedAt), update Transaction model for purchase tracking
---[ ] NAME:5.2 Backend: Install and configure Klarna SDK DESCRIPTION:Install Klarna SDK package, configure API credentials (username, password, base URL), set up environment variables, create Klarna client wrapper utility
---[ ] NAME:5.3 Backend: Create Premium Pack management API DESCRIPTION:Create admin APIs: POST /api/admin/packs (create pack), GET /api/admin/packs (list packs), PATCH /api/admin/packs/[id] (update pack), DELETE /api/admin/packs/[id] (deactivate pack)
---[ ] NAME:5.4 Backend: Create payment initiation API DESCRIPTION:Create POST /api/payment/initiate endpoint: validate pack selection, create Klarna payment session, store pending purchase record, return Klarna client token and session data
---[ ] NAME:5.5 Backend: Implement Klarna webhook handler DESCRIPTION:Create POST /api/payment/webhook endpoint: verify Klarna signature, handle payment confirmation, grant guaranteed merchandise item, grant bonus draw tickets, update purchase status, create transaction records, send confirmation email
---[ ] NAME:5.6 Backend: Implement transactional integrity DESCRIPTION:Wrap payment completion in Prisma transaction: update purchase status, create UserPrize for guaranteed item, create DrawTickets, create Transaction records. Implement rollback on failure
---[ ] NAME:5.7 Frontend: Create Premium Pack store page DESCRIPTION:Create /store page: display available packs with images, show guaranteed item + bonus tickets, display pricing, add pack selection UI, integrate Klarna payment widget
---[ ] NAME:5.8 Frontend: Integrate Klarna payment widget DESCRIPTION:Integrate Klarna Payments SDK on frontend: load Klarna script, initialize payment widget, handle payment authorization, handle success/failure callbacks, show loading states
---[ ] NAME:5.9 Frontend: Create purchase history page DESCRIPTION:Create /purchases page: display user's purchase history, show pack details and items received, display payment status, provide receipt download
---[ ] NAME:5.10 Testing: Test payment flow end-to-end DESCRIPTION:Test with Klarna sandbox: initiate payment, complete payment, verify webhook reception, verify guaranteed item granted, verify tickets granted, test payment failure scenarios, test webhook retry logic
--[ ] NAME:Task 6: Mission Engine Implementation DESCRIPTION:Develop asynchronous mission verification system with TikTok API integration and reward distribution
---[ ] NAME:6.1 Backend: Update Prisma schema for missions DESCRIPTION:Extend Task model: add missionType enum (FOLLOW, LIKE, REPOST, USE_AUDIO), add targetTikTokAccount, targetVideoUrl, targetAudioId, verificationStatus, autoVerify boolean. Add MissionVerificationJob model for async processing
---[ ] NAME:6.2 Backend: Set up async job processing system DESCRIPTION:Choose and configure job queue system (BullMQ with Redis, or Vercel Cron Jobs). Create job worker infrastructure, implement retry logic, add job status tracking
---[ ] NAME:6.3 Backend: Integrate TikTok API for Follow/Like verification DESCRIPTION:Set up TikTok API credentials, implement API client wrapper, create verification functions: verifyUserFollowsAccount(), verifyUserLikedVideo(). Handle rate limiting and errors
---[ ] NAME:6.4 Backend: Integrate Managed Scraping API for Repost verification DESCRIPTION:Research and select Managed Scraping API service (e.g., ScrapingBee, Apify), implement API client, create verifyUserRepostedVideo() function to check if user's profile contains repost of target video
---[ ] NAME:6.5 Backend: Implement Use Audio mission verification DESCRIPTION:Implement production-ready verifyUserUsedAudio() function: use TikTok API to search user's videos, check if any video uses specified audio track, handle edge cases (private videos, deleted content)
---[ ] NAME:6.6 Backend: Create mission submission API DESCRIPTION:Create POST /api/missions/[missionId]/submit endpoint: validate user has TikTok linked, create pending UserTask record, enqueue verification job, return submission confirmation
---[ ] NAME:6.7 Backend: Implement async verification worker DESCRIPTION:Create verification worker: process jobs from queue, call appropriate verification function based on mission type, update UserTask verification status, grant Diamonds on success, handle failures with retry
---[ ] NAME:6.8 Backend: Implement reward distribution system DESCRIPTION:Create reward distribution logic: on successful verification, update user Diamond balance in transaction, create Transaction record, send notification to user, update mission completion count
---[ ] NAME:6.9 Backend: Create mission management APIs DESCRIPTION:Create admin APIs: POST /api/admin/missions (create mission), GET /api/admin/missions (list missions), PATCH /api/admin/missions/[id] (update mission), GET /api/admin/missions/[id]/submissions (view submissions)
---[ ] NAME:6.10 Frontend: Create mission listing page DESCRIPTION:Create /missions page: display available TikTok missions grouped by type, show mission requirements clearly, display reward amounts (Diamonds), show completion status, add Start Mission buttons
---[ ] NAME:6.11 Frontend: Create mission detail page DESCRIPTION:Create /missions/[id] page: show detailed mission instructions, display target TikTok account/video/audio, show verification status, provide Submit button, show estimated verification time
---[ ] NAME:6.12 Frontend: Implement mission status tracking DESCRIPTION:Create real-time status updates: show pending verification state, display verification progress, show success/failure notifications, update Diamond balance on completion
---[ ] NAME:6.13 Testing: Test mission verification flows DESCRIPTION:Test each mission type: Follow verification with real TikTok account, Like verification, Repost verification with scraping API, Use Audio verification. Test edge cases: unlinked TikTok account, failed verifications, rate limiting, concurrent submissions
-[ ] NAME:Task 7: Merchandise Store System Implementation DESCRIPTION:Complete the merchandise e-commerce system with product details, shopping cart, payment integration, and order management
--[ ] NAME:7.1 Backend: Create Merchandise Prisma schema DESCRIPTION:Add Merchandise model (id, name, description, price, category, sizes, colors, imageUrl, inStock, featured, tags, material, features, createdAt, updatedAt), MerchandiseVariant model for size/color combinations, and MerchandiseImage model for multiple product images
--[ ] NAME:7.2 Backend: Create merchandise management APIs DESCRIPTION:Create admin APIs: POST /api/admin/merchandise (create product), GET /api/admin/merchandise (list products), PATCH /api/admin/merchandise/[id] (update product), DELETE /api/admin/merchandise/[id] (delete product), manage inventory and variants
--[ ] NAME:7.3 Backend: Implement shopping cart system DESCRIPTION:Create Cart and CartItem models in Prisma schema, implement cart APIs: GET /api/cart (get cart), POST /api/cart/add (add item), PATCH /api/cart/update (update quantity), DELETE /api/cart/remove (remove item), handle size/color selection
--[ ] NAME:7.4 Backend: Create merchandise order system DESCRIPTION:Add Order and OrderItem models to Prisma schema, create order APIs: POST /api/orders/create (create order from cart), GET /api/orders (list user orders), GET /api/orders/[id] (order details), implement order status tracking (pending, processing, shipped, delivered)
--[ ] NAME:7.5 Backend: Integrate payment for merchandise DESCRIPTION:Extend Klarna/Stripe integration for merchandise purchases, create POST /api/payment/merchandise/initiate endpoint, handle payment webhook for merchandise orders, update order status on payment confirmation, handle inventory deduction
--[ ] NAME:7.6 Frontend: Create merchandise detail page DESCRIPTION:Create /store/[id] page: display product images with gallery/zoom, show size and color selectors, display product details and features, show stock availability, add to cart button, related products section, customer reviews placeholder
--[ ] NAME:7.7 Frontend: Implement shopping cart UI DESCRIPTION:Create cart sidebar/page: display cart items with thumbnails, show size/color selections, quantity adjustment controls, remove item buttons, display subtotal and shipping, proceed to checkout button, empty cart state
--[ ] NAME:7.8 Frontend: Create checkout flow DESCRIPTION:Create /store/checkout page: shipping address form, payment method selection, order summary, apply discount codes, integrate payment widget (Klarna/Stripe), order confirmation page, email confirmation
--[ ] NAME:7.9 Frontend: Implement filter and sort functionality DESCRIPTION:Connect MerchandiseFilters component to actual data: implement category filtering logic, implement sorting (price, name, newest), add price range filter, add size/color filters, update URL params for shareable filtered views
--[ ] NAME:7.10 Frontend: Create order history page DESCRIPTION:Create /orders page: display user's order history, show order status with tracking, display order items with images, provide order details view, download invoice/receipt, reorder functionality
--[ ] NAME:7.11 Testing: Test merchandise e-commerce flow DESCRIPTION:Test complete flow: browse products, filter/sort, view product details, add to cart, update cart, checkout with payment, verify order creation, test inventory deduction, test order status updates, test edge cases (out of stock, payment failure)