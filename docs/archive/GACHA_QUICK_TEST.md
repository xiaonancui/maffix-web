# 🎰 Gacha 抽奖功能 - 快速测试指南

## ⏱️ 预计时间：3-5 分钟

---

## 🔐 测试账户

```
Email: admin@maffix.com
Password: password123
```

**初始资源**：
- 💎 钻石余额：10,000
- 可进行 100 次单次抽奖
- 可进行 11 次 10 连抽

---

## ✅ 测试步骤

### 1️⃣ 登录并访问 Gacha 页面

1. 访问 https://www.maffix.xyz/login
2. 使用测试账户登录
3. 点击导航栏的 **"Gacha"** 或访问 https://www.maffix.xyz/gacha

**预期结果**：
- ✅ 页面显示 "Lucky Draw" 标题
- ✅ 显示钻石余额：10,000 💎
- ✅ 显示两个抽奖按钮：
  - "Pull Once (100 💎)"
  - "Pull 10x (900 💎)"

---

### 2️⃣ 测试单次抽奖

1. 点击 **"Pull Once (100 💎)"** 按钮
2. 等待抽奖动画（约 0.3 秒）
3. 查看抽奖结果弹窗

**预期结果**：
- ✅ 按钮显示 "🎰 Pulling..." 动画
- ✅ 弹出抽奖结果弹窗
- ✅ 显示获得的奖品信息：
  - 奖品名称（带 emoji）
  - 稀有度标签（LEGENDARY/SSR/EPIC/RARE/COMMON）
  - 奖品描述
  - 奖品价值
- ✅ 稀有度颜色正确：
  - 🏆 LEGENDARY: 金色渐变
  - ⭐ SSR: 琥珀色渐变
  - 💜 EPIC: 紫色渐变
  - 💙 RARE: 蓝色渐变
  - ⚪ COMMON: 灰色渐变
- ✅ 关闭弹窗后，钻石余额减少 100（变为 9,900）

---

### 3️⃣ 测试 10 连抽

1. 点击 **"Pull 10x (900 💎)"** 按钮
2. 等待抽奖动画（约 0.5 秒）
3. 查看 10 个奖品的结果

**预期结果**：
- ✅ 按钮显示 "🎰 Pulling..." 动画
- ✅ 弹出抽奖结果弹窗，显示 10 个奖品
- ✅ **至少有 1 个 SSR 或更高稀有度的奖品**（保底机制）
- ✅ 可以滚动查看所有 10 个奖品
- ✅ 每个奖品都有完整信息（名称、稀有度、描述、价值）
- ✅ 关闭弹窗后，钻石余额减少 900（变为 9,000）

---

### 4️⃣ 测试余额不足

1. 多次抽奖直到钻石余额低于 100
2. 尝试点击 **"Pull Once"** 按钮

**预期结果**：
- ✅ 按钮变为禁用状态（灰色，opacity: 0.5）
- ✅ 鼠标悬停时按钮不放大（hover:scale-100）
- ✅ 点击按钮时显示 "Not enough diamonds!" 提示

---

### 5️⃣ 测试抽奖券显示（可选）

1. 在 Gacha 页面查找 "Draw Tickets" 卡片
2. 查看显示的抽奖券数量

**预期结果**：
- ✅ 显示 2 张单次抽奖券 🎫
- ✅ 显示 1 张 10 连抽券 🎟️
- ✅ 显示抽奖券来源（Welcome Bonus, Daily Login, Premium Pack）

**注意**：测试账户无法实际使用抽奖券，这是正常的。

---

## 🎁 奖品稀有度概率

| 稀有度 | 概率 | 奖品示例 |
|--------|------|----------|
| 🏆 LEGENDARY | 1% | VIP Concert Backstage Pass (1000 💎) |
| ⭐ SSR | 4% | Limited Edition Signed Vinyl (500 💎) |
| 💜 EPIC | 10% | Exclusive Merchandise Bundle (200 💎) |
| 💙 RARE | 25% | Digital Album + Bonus Tracks (100 💎) |
| ⚪ COMMON | 60% | Fan Club Sticker (20 💎) |

---

## ❌ 常见问题

### 问题 1: 仍然显示 "Service temporarily unavailable"

**解决方案**：
1. 等待 2-3 分钟让 Vercel 部署完成
2. 清除浏览器缓存或使用无痕模式
3. 检查 Vercel 部署状态：https://vercel.com/dashboard

### 问题 2: 抽奖后钻石余额没有变化

**原因**：测试账户使用 mock data，余额是模拟的。

**解决方案**：关闭抽奖结果弹窗后，页面会自动刷新并更新余额。

### 问题 3: 抽奖结果弹窗不显示

**解决方案**：
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签的错误信息
3. 查看 Network 标签，确认 API 请求成功（状态码 200）

### 问题 4: 10 连抽中没有 SSR

**原因**：这不应该发生，10 连抽有保底机制。

**解决方案**：
1. 检查所有 10 个奖品，确认没有遗漏
2. 如果确实没有 SSR，请报告此 bug

---

## 🔍 调试工具

### 检查环境变量

访问：https://www.maffix.xyz/api/test-env

**预期输出**：
```json
{
  "testAccountsEnabled": true,
  "environment": {
    "enableTestAccounts": "true",
    "allowTestAccounts": true
  }
}
```

### 检查 API 响应

打开浏览器开发者工具（F12），切换到 **Network** 标签：

1. 执行一次抽奖
2. 找到 `/api/gacha/pull` 或 `/api/gacha/pull-10x` 请求
3. 查看响应状态码和内容

**预期响应**：
- 状态码：200 OK
- 响应包含 `success: true`
- 响应包含 `prize` 或 `prizes` 数组
- 响应包含 `newBalance` 字段

---

## ✅ 测试完成标志

- [ ] 单次抽奖成功，显示奖品信息
- [ ] 10 连抽成功，至少有 1 个 SSR
- [ ] 钻石余额正确扣除
- [ ] 余额不足时按钮禁用
- [ ] 抽奖券正确显示（2 单次 + 1 十连）
- [ ] 稀有度颜色正确显示
- [ ] 抽奖动画流畅

---

## 📊 测试结果报告模板

```
测试日期：____________________
测试人员：____________________

✅ 单次抽奖：[ ] 通过  [ ] 失败
✅ 10 连抽：[ ] 通过  [ ] 失败
✅ 余额扣除：[ ] 通过  [ ] 失败
✅ 余额不足：[ ] 通过  [ ] 失败
✅ 抽奖券显示：[ ] 通过  [ ] 失败

问题描述：
_______________________________________
_______________________________________
_______________________________________

截图：
（如有问题，请附上截图）
```

---

**修复完成日期**：2025-10-22  
**修复版本**：Commit 7f5b856  
**预计测试时间**：3-5 分钟

