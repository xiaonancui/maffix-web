# 颜色体系重构计划

**日期：** 2025-11-22  
**项目：** Maffix Web  
**目标：** 从自定义红色主题迁移到 shadcn/ui 默认颜色体系，并实现亮色/暗色主题切换

---

## 📋 项目概述

### 当前状态
- **主题系统：** 固定的深色主题，使用自定义红色 (#FF5656) 作为主色
- **背景颜色：** #0a0a0a (主背景), #1a1a1a (卡片背景)
- **边框颜色：** red-500/20 (红色半透明边框)
- **硬编码颜色：** 大量使用 bg-[#...], text-[#...], border-[#...] 等硬编码颜色
- **主题切换：** 不支持

### 目标状态
- **主题系统：** 支持亮色/暗色/系统自动三种模式
- **颜色体系：** 使用 shadcn/ui 默认的 Zinc 主题
- **语义化颜色：** 所有颜色使用 CSS 变量（bg-background, text-foreground, border-border 等）
- **用户偏好：** 用户可以在个人档案中设置主题偏好，保存到数据库
- **全局切换：** 在 Admin 和 Dashboard 页面头部添加主题切换按钮

---

## 🎯 核心变更

### 1. CSS 变量变更

#### 亮色主题 (:root)
```css
/* 当前（自定义红色） */
--primary: 0 72% 66%;  /* #FF5656 */
--background: 0 0% 100%;
--card: 0 0% 100%;

/* 目标（shadcn/ui Zinc） */
--primary: 240 5.9% 10%;  /* Zinc-950 */
--background: 0 0% 100%;  /* White */
--card: 0 0% 100%;  /* White */
--border: 240 5.9% 90%;  /* Zinc-200 */
```

#### 暗色主题 (.dark)
```css
/* 当前（自定义红色） */
--primary: 0 72% 66%;  /* #FF5656 */
--background: 0 0% 3.9%;  /* #0a0a0a */
--card: 0 0% 10.2%;  /* #1a1a1a */
--border: 0 72% 66% / 0.2;  /* red-500/20 */

/* 目标（shadcn/ui Zinc） */
--primary: 240 5.9% 90%;  /* Zinc-50 */
--background: 240 10% 3.9%;  /* Zinc-950 */
--card: 240 3.7% 15.9%;  /* Zinc-900 */
--border: 240 3.7% 15.9%;  /* Zinc-800 */
```

### 2. 颜色替换映射表

| 当前颜色 | 替换为 | 说明 |
|---------|--------|------|
| `#FF5656` | `hsl(var(--primary))` | 主色 |
| `bg-[#FF5656]` | `bg-primary` | 主色背景 |
| `text-[#FF5656]` | `text-primary` | 主色文字 |
| `border-[#FF5656]` | `border-primary` | 主色边框 |
| `#0a0a0a` | `hsl(var(--background))` | 主背景 |
| `bg-[#0a0a0a]` | `bg-background` | 主背景 |
| `#1a1a1a` | `hsl(var(--card))` | 卡片背景 |
| `bg-[#1a1a1a]` | `bg-card` | 卡片背景 |
| `bg-gray-900` | `bg-card` | 卡片背景 |
| `border-red-500/20` | `border-border` | 边框 |
| `border-gray-800` | `border-border` | 边框 |
| `text-white` | `text-foreground` | 前景文字 |
| `text-gray-400` | `text-muted-foreground` | 次要文字 |

### 3. 保留的颜色

以下颜色**不需要替换**，保持原样：

- **霓虹灯效果：** `neon.cyan`, `neon.magenta`, `neon.yellow`, `neon.green`
- **稀有度渐变：** Gacha 系统中的稀有度颜色（LEGENDARY, SSR, EPIC 等）
- **状态颜色：** 成功（绿色）、警告（黄色）、错误（红色）、信息（蓝色）

---

## 📦 技术栈

### 新增依赖
- **next-themes** (^0.2.1) - 主题切换库

### 新增组件
- `src/components/theme/ThemeProvider.tsx` - 主题提供者
- `src/components/theme/ThemeToggle.tsx` - 主题切换按钮

### 数据库变更
- `User.themePreference` - 用户主题偏好字段（light/dark/system）

---

## 🔄 执行阶段

### 阶段 1: 数据库模型扩展 (30 分钟)
1. 修改 Prisma Schema，添加 `themePreference` 字段
2. 生成数据库迁移
3. 更新 Prisma Client

### 阶段 2: 更新 CSS 变量 (1 小时)
1. 备份当前 `globals.css`
2. 更新亮色主题 CSS 变量
3. 更新暗色主题 CSS 变量
4. 移除 Tailwind 中的 `brand` 颜色

### 阶段 3: 创建主题切换组件 (2 小时)
1. 安装 `next-themes`
2. 创建 `ThemeProvider` 组件
3. 创建 `ThemeToggle` 组件（支持 light/dark/system）
4. 在 RootLayout 中集成 `ThemeProvider`

### 阶段 4: 替换硬编码颜色 (4-6 小时)
1. 扫描所有硬编码颜色
2. 创建颜色替换映射表
3. 批量替换背景颜色
4. 批量替换主色
5. 批量替换边框颜色

### 阶段 5: 更新 Admin 页面 (4-6 小时)
1. 更新 `AdminSidebar` 组件
2. 更新 `AdminHeader` 组件
3. 更新 `StatusBadge` 组件
4. 更新 `DataTable` 组件
5. 更新所有 Admin 页面

### 阶段 6: 更新 Dashboard 页面 (4-6 小时)
1. 更新 `DashboardHeader` 组件
2. 更新 `GachaResultModal`（保留稀有度渐变）
3. 更新 `PremiumPackCard`
4. 更新 `MerchandiseCard`
5. 更新所有 Dashboard 页面

### 阶段 7: 更新 Marketing 页面 (2-3 小时)
1. 保留霓虹灯颜色
2. 更新 `Hero` 组件
3. 更新 `ButtonEnhanced`
4. 更新 `FloatingElements`
5. 测试视觉效果

### 阶段 8: 添加用户设置 (3-4 小时)
1. 创建用户设置 API (`/api/user/settings`)
2. 在 Profile 页面添加主题设置
3. 在 AdminHeader 添加 ThemeToggle
4. 在 DashboardHeader 添加 ThemeToggle
5. 实现主题偏好同步

### 阶段 9: 测试和优化 (4-6 小时)
1. 测试亮色主题
2. 测试暗色主题
3. 测试主题切换功能
4. 修复视觉问题
5. 性能优化
6. 创建文档

---

## ⏱️ 时间估算

| 阶段 | 预估时间 | 优先级 |
|------|---------|--------|
| 阶段 1: 数据库模型扩展 | 0.5 小时 | 高 |
| 阶段 2: 更新 CSS 变量 | 1 小时 | 高 |
| 阶段 3: 创建主题切换组件 | 2 小时 | 高 |
| 阶段 4: 替换硬编码颜色 | 4-6 小时 | 高 |
| 阶段 5: 更新 Admin 页面 | 4-6 小时 | 中 |
| 阶段 6: 更新 Dashboard 页面 | 4-6 小时 | 中 |
| 阶段 7: 更新 Marketing 页面 | 2-3 小时 | 低 |
| 阶段 8: 添加用户设置 | 3-4 小时 | 中 |
| 阶段 9: 测试和优化 | 4-6 小时 | 高 |
| **总计** | **25-35 小时** | - |

---

## ⚠️ 风险评估

### 高风险
- **视觉效果变化：** 从红色主题改为 Zinc 主题，视觉风格会有较大变化
- **对比度问题：** 亮色主题可能存在对比度不足的问题
- **Marketing 页面：** 霓虹灯效果在亮色主题下可能不明显

### 中风险
- **硬编码颜色遗漏：** 可能有部分硬编码颜色未被发现
- **第三方组件：** 某些第三方组件可能不支持主题切换

### 低风险
- **性能影响：** next-themes 可能增加少量 JavaScript 体积
- **浏览器兼容性：** CSS 变量在旧浏览器中可能不支持

---

## ✅ 验收标准

### 功能要求
- ✅ 支持亮色/暗色/系统自动三种主题模式
- ✅ 用户可以在个人档案中设置主题偏好
- ✅ 主题偏好保存到数据库，登录时自动加载
- ✅ Admin 和 Dashboard 页面头部有主题切换按钮
- ✅ 主题切换无闪烁，过渡流畅

### 视觉要求
- ✅ 所有页面在亮色主题下可读性良好
- ✅ 所有页面在暗色主题下可读性良好
- ✅ Marketing 页面的霓虹灯效果保持不变
- ✅ Gacha 系统的稀有度颜色保持不变
- ✅ 所有组件的对比度符合 WCAG AA 标准

### 技术要求
- ✅ 所有硬编码颜色已替换为 CSS 变量
- ✅ 构建成功，无 TypeScript 错误
- ✅ 无 console 警告或错误
- ✅ 代码符合项目规范

---

## 📖 参考资源

- **shadcn/ui 主题：** https://ui.shadcn.com/themes
- **next-themes 文档：** https://github.com/pacocoursey/next-themes
- **Tailwind CSS 暗色模式：** https://tailwindcss.com/docs/dark-mode
- **WCAG 对比度标准：** https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html

---

## 🎨 视觉效果对比

### 当前主题（自定义红色）
```
┌─────────────────────────────────────┐
│ 深色背景 (#0a0a0a)                   │
│ ┌─────────────────────────────────┐ │
│ │ 卡片背景 (#1a1a1a)               │ │
│ │ 红色边框 (red-500/20)            │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │ 红色按钮 (#FF5656)           │ │ │
│ │ └─────────────────────────────┘ │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 目标主题（shadcn/ui Zinc）

#### 亮色模式
```
┌─────────────────────────────────────┐
│ 白色背景 (White)                     │
│ ┌─────────────────────────────────┐ │
│ │ 白色卡片 (White)                 │ │
│ │ 灰色边框 (Zinc-200)              │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │ 深灰按钮 (Zinc-950)          │ │ │
│ │ └─────────────────────────────┘ │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 暗色模式
```
┌─────────────────────────────────────┐
│ 深灰背景 (Zinc-950)                  │
│ ┌─────────────────────────────────┐ │
│ │ 灰色卡片 (Zinc-900)              │ │
│ │ 灰色边框 (Zinc-800)              │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │ 浅灰按钮 (Zinc-50)           │ │ │
│ │ └─────────────────────────────┘ │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 🚀 快速开始

### 查看任务列表
所有任务已整理到 **Tasks Tab**，包含 9 个主要阶段和 47 个子任务。

### 开始执行
等待用户确认后，将按以下顺序执行：
1. 阶段 1: 数据库模型扩展
2. 阶段 2: 更新 CSS 变量
3. 阶段 3: 创建主题切换组件
4. 阶段 4-7: 批量替换颜色
5. 阶段 8: 添加用户设置
6. 阶段 9: 测试和优化

### 回滚方案
如果需要回滚：
1. 恢复 `globals.css.backup`
2. 回滚数据库迁移：`npx prisma migrate reset`
3. 移除 `next-themes` 依赖
4. 删除 `ThemeProvider` 和 `ThemeToggle` 组件

